import React from 'react'; import { renderWithProviders } from '../utils/test-utils'; import { AuthProvider } from '@/providers/AuthProvider'; import { createUser } from '../utils/factories'; describe('AuthProvider', () => { it('provides isAuthenticated=false when no token', () => { const { getByText } = renderWithProviders(<AuthProvider>{({ isAuthenticated }) => <Text>{isAuthenticated ? 'Authenticated' : 'Not Authenticated'}</Text>}</AuthProvider>); expect(getByText('Not Authenticated')).toBeTruthy(); }); it('provides isAuthenticated=true when valid token exists', () => { const { getByText } = renderWithProviders(<AuthProvider>{({ isAuthenticated }) => <Text>{isAuthenticated ? 'Authenticated' : 'Not Authenticated'}</Text>}</AuthProvider>, { overrideAuth: { token: 'valid-token' } }); expect(getByText('Authenticated')).toBeTruthy(); }); it('login stores token and updates state', async () => { const user = createUser(); const { result } = renderHook(() => useAuth(), { wrapper: AuthProvider }); await act(async () => { await result.current.login(user.email, user.password); }); expect(result.current.isAuthenticated).toBe(true); }); it('logout clears token and updates state', async () => { const { result } = renderHook(() => useAuth(), { wrapper: AuthProvider }); await act(async () => { await result.current.logout(); }); expect(result.current.isAuthenticated).toBe(false); }); it('signup creates account and stores token', async () => { const user = createUser(); const { result } = renderHook(() => useAuth(), { wrapper: AuthProvider }); await act(async () => { await result.current.signup(user.email, user.password); }); expect(result.current.isAuthenticated).toBe(true); }); it('handles token refresh on 401', async () => { mockApi({ token: 'new-token' }, 401); const { result } = renderHook(() => useAuth(), { wrapper: AuthProvider }); await act(async () => { await result.current.refreshToken(); }); expect(result.current.token).toBe('new-token'); }); });