import { renderHook, act } from '@testing-library/react-hooks'; import useXxx from '@/hooks/useXxx'; import { mockApi } from '../utils/test-utils'; describe('useXxx', () => { it('returns loading=true initially', () => { const { result } = renderHook(() => useXxx()); expect(result.current.loading).toBe(true); }); it('returns data on successful fetch', async () => { mockApi([{ id: 1, name: 'Item 1' }]); const { result, waitForNextUpdate } = renderHook(() => useXxx()); await waitForNextUpdate(); expect(result.current.data).toEqual([{ id: 1, name: 'Item 1' }]); }); it('returns error on failed fetch', async () => { mockApi({}, 500); const { result, waitForNextUpdate } = renderHook(() => useXxx()); await waitForNextUpdate(); expect(result.current.error).toBeTruthy(); }); it('refetch works after error', async () => { mockApi({}, 500); const { result, waitForNextUpdate } = renderHook(() => useXxx()); await waitForNextUpdate(); mockApi([{ id: 1, name: 'Item 1' }]); act(() => { result.current.refetch(); }); await waitForNextUpdate(); expect(result.current.data).toEqual([{ id: 1, name: 'Item 1' }]); }); it('handles empty response', async () => { mockApi([]); const { result, waitForNextUpdate } = renderHook(() => useXxx()); await waitForNextUpdate(); expect(result.current.data).toEqual([]); }); });