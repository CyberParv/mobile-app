import axios from 'axios'; import { getApiClient } from '@/lib/api'; describe('API Client', () => { it('adds auth header when token exists', () => { const apiClient = getApiClient('valid-token'); expect(apiClient.defaults.headers.common['Authorization']).toBe('Bearer valid-token'); }); it('does not add auth header when no token', () => { const apiClient = getApiClient(); expect(apiClient.defaults.headers.common['Authorization']).toBeUndefined(); }); it('handles network timeout', async () => { jest.spyOn(axios, 'get').mockImplementationOnce(() => Promise.reject(new Error('timeout'))); const apiClient = getApiClient(); await expect(apiClient.get('/endpoint')).rejects.toThrow('timeout'); }); it('retries on network failure', async () => { jest.spyOn(axios, 'get').mockImplementationOnce(() => Promise.reject(new Error('Network Error'))).mockImplementationOnce(() => Promise.resolve({ data: {} })); const apiClient = getApiClient(); const response = await apiClient.get('/endpoint'); expect(response.data).toEqual({}); }); });