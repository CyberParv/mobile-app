import axios from 'axios'; import { mockApi } from '../utils/test-utils'; describe('API', () => { it('adds auth header when token exists', async () => { const token = 'valid-token'; mockApi({}, 200); axios.defaults.headers.common['Authorization'] = `Bearer ${token}`; const response = await axios.get('/endpoint'); expect(response.config.headers['Authorization']).toBe(`Bearer ${token}`); }); it('does not add auth header when no token', async () => { mockApi({}, 200); delete axios.defaults.headers.common['Authorization']; const response = await axios.get('/endpoint'); expect(response.config.headers['Authorization']).toBeUndefined(); }); it('handles network timeout', async () => { mockApi({}, 408); try { await axios.get('/endpoint'); } catch (error) { expect(error.message).toBe('Network Error'); } }); it('retries on network failure', async () => { mockApi({}, 500); let retries = 0; axios.interceptors.response.use(null, async (error) => { if (retries < 3) { retries += 1; return axios.request(error.config); } return Promise.reject(error); }); try { await axios.get('/endpoint'); } catch (error) { expect(retries).toBe(3); } }); });