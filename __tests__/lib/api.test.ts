import axios from 'axios'; import { getApiClient } from '@/lib/api'; describe('API Client', () => { it('adds auth header when token exists', () => { const api = getApiClient('valid-token'); expect(api.defaults.headers.common['Authorization']).toBe('Bearer valid-token'); }); it('does not add auth header when no token', () => { const api = getApiClient(); expect(api.defaults.headers.common['Authorization']).toBeUndefined(); }); it('handles network timeout', async () => { jest.spyOn(axios, 'get').mockRejectedValueOnce(new Error('timeout')); const api = getApiClient(); await expect(api.get('/timeout')).rejects.toThrow('timeout'); }); it('retries on network failure', async () => { jest.spyOn(axios, 'get').mockRejectedValueOnce(new Error('Network Error')).mockResolvedValueOnce({ data: [] }); const api = getApiClient(); await expect(api.get('/retry')).resolves.toEqual({ data: [] }); }); });