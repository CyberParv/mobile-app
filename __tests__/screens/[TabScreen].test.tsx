import React from 'react'; import { render, waitFor, fireEvent } from '@testing-library/react-native'; import TabScreen from '@/app/(tabs)/index'; import { mockApi, renderWithProviders } from '../utils/test-utils'; describe('Tab Screen', () => { beforeEach(() => { mockApi(); }); it('renders loading skeleton initially', () => { const { getByTestId } = renderWithProviders(<TabScreen />); expect(getByTestId('skeleton-loader')).toBeTruthy(); }); it('renders data after successful fetch', async () => { const { getByText } = renderWithProviders(<TabScreen />); await waitFor(() => { expect(getByText('Data Item 1')).toBeTruthy(); }); }); it('renders empty state when no data', async () => { mockApi().get.mockResolvedValueOnce({ data: [] }); const { getByText } = renderWithProviders(<TabScreen />); await waitFor(() => { expect(getByText('No data available')).toBeTruthy(); }); }); it('renders error state when fetch fails', async () => { mockApi().get.mockRejectedValueOnce(new Error('Fetch error')); const { getByText } = renderWithProviders(<TabScreen />); await waitFor(() => { expect(getByText('Error loading data')).toBeTruthy(); }); }); it('pull-to-refresh triggers refetch', async () => { const { getByTestId } = renderWithProviders(<TabScreen />); fireEvent(getByTestId('scroll-view'), 'refresh'); await waitFor(() => { expect(mockApi().get).toHaveBeenCalledTimes(2); }); }); it('navigation to detail screen works', () => { const navigate = jest.fn(); const { getByText } = renderWithProviders(<TabScreen />); fireEvent.press(getByText('Data Item 1')); expect(navigate).toHaveBeenCalledWith('DetailScreen', { id: 1 }); }); });