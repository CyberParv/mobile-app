import React from 'react'; import { fireEvent, render } from '@testing-library/react-native'; import Login from '@/app/(auth)/login'; import { renderWithProviders } from '../utils/test-utils'; describe('Login Screen', () => { it('renders email and password inputs', () => { const { getByPlaceholderText } = renderWithProviders(<Login />); expect(getByPlaceholderText('Email')).toBeTruthy(); expect(getByPlaceholderText('Password')).toBeTruthy(); }); it('shows validation errors for empty fields on submit', () => { const { getByText, getByTestId } = renderWithProviders(<Login />); fireEvent.press(getByTestId('login-button')); expect(getByText('Email is required')).toBeTruthy(); expect(getByText('Password is required')).toBeTruthy(); }); it('shows validation error for invalid email format', () => { const { getByText, getByPlaceholderText, getByTestId } = renderWithProviders(<Login />); fireEvent.changeText(getByPlaceholderText('Email'), 'invalid-email'); fireEvent.press(getByTestId('login-button')); expect(getByText('Invalid email format')).toBeTruthy(); }); it('calls login() with credentials on valid submit', () => { const login = jest.fn(); const { getByPlaceholderText, getByTestId } = renderWithProviders(<Login login={login} />); fireEvent.changeText(getByPlaceholderText('Email'), 'user@example.com'); fireEvent.changeText(getByPlaceholderText('Password'), 'password'); fireEvent.press(getByTestId('login-button')); expect(login).toHaveBeenCalledWith({ email: 'user@example.com', password: 'password' }); }); it('shows loading state during login', () => { const { getByTestId } = renderWithProviders(<Login loading={true} />); expect(getByTestId('loading-spinner')).toBeTruthy(); }); it('shows error message when login fails (401)', () => { const { getByText } = renderWithProviders(<Login error='Unauthorized' />); expect(getByText('Unauthorized')).toBeTruthy(); }); it('shows error message when network is down', () => { const { getByText } = renderWithProviders(<Login error='Network error' />); expect(getByText('Network error')).toBeTruthy(); }); it('navigates to main app on successful login', () => { const { getByTestId } = renderWithProviders(<Login />); fireEvent.press(getByTestId('login-button')); // Mock successful login expect(mockNavigate).toHaveBeenCalledWith('MainApp'); }); it('navigates to signup screen when link tapped', () => { const { getByText } = renderWithProviders(<Login />); fireEvent.press(getByText('Sign up')); expect(mockNavigate).toHaveBeenCalledWith('Signup'); }); });