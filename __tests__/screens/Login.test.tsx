import React from 'react'; import { fireEvent, render } from '@testing-library/react-native'; import Login from '@/app/(auth)/login'; import { mockApi } from '../utils/test-utils'; describe('Login Screen', () => { it('renders email and password inputs', () => { const { getByPlaceholderText } = render(<Login />); expect(getByPlaceholderText('Email')).toBeTruthy(); expect(getByPlaceholderText('Password')).toBeTruthy(); }); it('shows validation errors for empty fields on submit', () => { const { getByText, getByRole } = render(<Login />); fireEvent.press(getByRole('button')); expect(getByText('Email is required')).toBeTruthy(); expect(getByText('Password is required')).toBeTruthy(); }); it('shows validation error for invalid email format', () => { const { getByText, getByPlaceholderText, getByRole } = render(<Login />); fireEvent.changeText(getByPlaceholderText('Email'), 'invalid-email'); fireEvent.press(getByRole('button')); expect(getByText('Invalid email format')).toBeTruthy(); }); it('calls login() with credentials on valid submit', () => { const login = jest.fn(); const { getByPlaceholderText, getByRole } = render(<Login login={login} />); fireEvent.changeText(getByPlaceholderText('Email'), 'user@example.com'); fireEvent.changeText(getByPlaceholderText('Password'), 'Password123!'); fireEvent.press(getByRole('button')); expect(login).toHaveBeenCalledWith({ email: 'user@example.com', password: 'Password123!' }); }); it('shows loading state during login', () => { const { getByRole, getByTestId } = render(<Login />); fireEvent.press(getByRole('button')); expect(getByTestId('spinner')).toBeTruthy(); }); it('shows error message when login fails (401)', async () => { mockApi({ message: 'Unauthorized' }, 401); const { getByText, getByRole } = render(<Login />); fireEvent.press(getByRole('button')); expect(await getByText('Unauthorized')).toBeTruthy(); }); it('shows error message when network is down', async () => { mockApi({}, 500); const { getByText, getByRole } = render(<Login />); fireEvent.press(getByRole('button')); expect(await getByText('Network error')).toBeTruthy(); }); it('navigates to main app on successful login', async () => { mockApi({ token: 'valid-token' }); const { getByRole } = render(<Login />); fireEvent.press(getByRole('button')); // Assume navigation is mocked expect(useRouter().push).toHaveBeenCalledWith('/main'); }); it('navigates to signup screen when link tapped', () => { const { getByText } = render(<Login />); fireEvent.press(getByText('Sign up')); expect(useRouter().push).toHaveBeenCalledWith('/signup'); }); });